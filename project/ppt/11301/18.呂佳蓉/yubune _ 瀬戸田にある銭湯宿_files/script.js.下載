$(function () {

	$('.room_img_main_01').slick({	
		asNavFor:".room_img_thumb_01",
		slidesToShow: 1,
		fade: true,
		arrows: false,
	});
	$('.room_img_thumb_01').slick({
		asNavFor:".room_img_main_01",
		slidesToShow: 12,
		focusOnSelect: true,
		lazyLoad:"progressive",
	});

	$('.room_img_main_02').slick({	
		asNavFor:".room_img_thumb_02",
		slidesToShow: 1,
		fade: true,
		arrows: false,
	});
	$('.room_img_thumb_02').slick({
		asNavFor:".room_img_main_02",
		slidesToShow: 12,
		focusOnSelect: true,
		lazyLoad:"progressive",
	});

	$('.room_img_main_03').slick({	
		asNavFor:".room_img_thumb_03",
		slidesToShow: 1,
		fade: true,
		arrows: false,
	});
	$('.room_img_thumb_03').slick({
		asNavFor:".room_img_main_03",
		slidesToShow: 12,
		focusOnSelect: true,
		lazyLoad:"progressive",
	});

	//グローバルナビ開閉
	$('.sp-btn-trigger').on('click', function(){
		$(this).toggleClass('is-active');
		$('.sp-nav-wrap').fadeToggle(500);
		return false;
	});
	
	$('.sp-nav-wrap a').on('click', function(){
		$('.sp-btn-trigger').removeClass('is-active');
		$('.sp-nav-wrap').fadeToggle(500);
	});

	let ScrTop;
	let viewerWidth = window.innerWidth ? window.innerWidth : $(window).width();
	let viewerHeight = window.innerHeight ? window.innerHeight : $(window).height();
	const firstViewerHeight = viewerHeight;
	let breakpoint = 750;
	let $swiper;
	let timer = false;
	let $slideshow1, $slideshow2;
	let h1_flg = true;
	let hash=location.hash;
	
	const setFillHeight = () => {
	  const vh = window.innerHeight * 0.01;
	  document.documentElement.style.setProperty('--vh', `${vh}px`);
	}

	$(window).load(function () {
		$("#loading").fadeOut(3000);

		if ($("#home").length) {
			setTimeout(function () {
				$("#news").addClass("show");
				$("#burger").addClass("news");
				$("#covid").addClass("show");
				$("#burger").addClass("covid");
			}, 1000);
		}
	});


	$(window).on("load resize", function () {
		viewerWidth = window.innerWidth ? window.innerWidth : $(window).width();
		viewerHeight = window.innerHeight ? window.innerHeight : $(window).height();
		
		//setFillHeight();

		if (viewerWidth > breakpoint) {

			if ($("body#home").length) {
				$("main section:nth-child(1), #news, #news >a").css("height", "100vh");
			}

		} else {
			if ($("body#home").length) {
				$("#news, #news >a").css("height", viewerHeight);
				$("main section:nth-child(1)").css("height", firstViewerHeight);
				//log($("main section:nth-child(1)").offset().top);
			}
		}
	});

	$(window).on("load scroll", function () {
		ScrTop = $(document).scrollTop();
		//console.log(ScrTop);

		if (viewerWidth > breakpoint) {
			$("header").removeClass("bg");
			if(ScrTop>0){
				$("header").addClass("s");
			}else{
				$("header").removeClass("s");
			}
		}else{
			$("header").removeClass("s");
			if(ScrTop>0){
				$("header").addClass("bg");
			}else{
				$("header").removeClass("bg");
			}
		}
		/*
		if ($("#home").length) {

			if (viewerWidth > breakpoint) {

			} else {
				let $h1;
				$h1 = $("main>section:nth-child(1) > div>h1");
				let y = ScrTop - ($h1.offset().top + $h1.height());
				if (y > 0) {
					$("header h1").addClass("show");
					h1_flg = true;
				} else {
					$("header h1").removeClass("show");
					h1_flg = false;
				}
			}

		} else {
			//$("header h1").addClass("show");
		}
		*/


		if (viewerWidth > breakpoint) {} else {}

		//(($(document).height()-viewerHeight)-ScrTop)<100
		
		if (viewerHeight >= $(document).height()) {
			$("a.pagetop, a.backto").addClass("show")
		} else {
			if (ScrTop > 50) {
				$("a.pagetop, a.backto").addClass("show")
			} else {
				$("a.pagetop, a.backto").removeClass("show")
			}
		}
		
		pre_ScrTop = ScrTop;
	});

	init();

	function init() {

		if ($("#home").length) {
			$("main > section:nth-child(1) .standby").each(function (i, e) {
				let d = i * 0.5;
				$(this).css("transition-delay", d + "s");
				$(this).addClass("go");
				
			});			
		}

		setTimeout(function(){

			$('#public_bath,#accommodation,#activity,#access').waypoint(function (direction) {
				let arr=['#public_bath','#accommodation','#activity','#access'];
				let activePoint = $(this.element);
				let page = activePoint.index('#public_bath,#accommodation,#activity,#access') + 1;
				let c=activePoint.attr("id").split("#");
				if (direction === 'down') { //scroll down				
				} else { //scroll up					
					page = page - 1
					//$("header nav.global li."+c).removeClass("current");
				}
				$("header nav.global li").removeClass("current");
				if(page>0){
					$("header nav.global li:nth-child("+page+")").addClass("current");
					let id=arr[page-1];
					//log(page);
					history.replaceState("", document.title, window.location.pathname  + id);
				}else{
					history.replaceState("", document.title, window.location.pathname);
				}
			}, {
				offset: '50%'
			});
			
			if(hash){
				//log($("main section:nth-child(1)").offset().top);
				/*
				$('.standby').each(function(){
					if($(this).offset().top<$(hash).offset().top){
					   $(this).removeClass("standby");
					 }
				});
				*/				
				goto(hash);
			}
			
			$('.standby').waypoint(function (direction) {
				let activePoint = $(this.element);
				if (direction === 'down') { //scroll down
					activePoint.addClass('go');
				} else { //scroll up
					//activePoint.removeClass('active');
				}
			}, {
				offset: '98%'
			});

		},100);

		if ($(".bogo-language-switcher").length) {
			let en = $(".bogo-language-switcher a[hreflang=en-US]").attr("href");
			if (en != void(0)) {
				$("nav.jpen a:nth-child(2)").attr("href", en);
			} else {
				$("nav.jpen a:nth-child(2)").addClass("disabled")
			}

			let jp = $(".bogo-language-switcher a[hreflang=ja]").attr("href");
			if (jp != void(0)) {
				$("nav.jpen a:nth-child(1)").attr("href", jp);
			} else {
				$("nav.jpen a:nth-child(1)").addClass("disabled")
			}

		}

		$("a.anchor, nav.global a").click(function () {
			let href = $(this).attr("href");
			if($("body.home").length){
				if(href.indexOf("#")!=-1){
					let hash="#"+href.split("#")[1]
					goto(hash);
					return false;
				}
			}
		
		});
					
		$("a.pagetop").click(function () {
			goto("#top");
			return false;
		});

		if ($("#home").length) {

			let $button_img=$("#news a").parent().find("button img");
			let $button_img_src=$button_img.attr("src");
			let $txt_img=$("#news a").find(" img");
			let $txt_img_src=$txt_img.attr("src");
			$("#news a").hover(
				function() {									
					$button_img.attr("src",$button_img_src.replace(".svg", "_over.svg"));
					$txt_img.attr("src",$txt_img_src.replace(".svg", "_over.svg"));	
				},
				function() {
					$button_img.attr("src",$button_img_src);
					$txt_img.attr("src",$txt_img_src);				
				}
			);

			$("#news button.close").click(function () {
				$("#news").removeClass("show");
				$("#burger").removeClass("news");
				return false;
			});

			$("#covid button.close").click(function () {
				$("#covid").removeClass("show");
				$("#burger").removeClass("covid");
				return false;
			});

			initSwiper();
		}

		if ($("#second").length) {
			initSwiper();
		}

		if ($('a.mail').length) {
			let mailLink = $('a.mail');
			let lineFeed = "\r\n";
			let subject, body;

			if (!$("body.en").length) {
				// 件名
				subject = 'お問い合わせ';
				// 本文
				body = [
					'●お名前(必須)：',
					'●メールアドレス(必須)：',
					'●電話番号(必須)：',
					'●住所：',
					'●お問い合わせ内容：'
				];

			} else {
				subject = '【Contact】';
				// 本文
				body = [
					'●Name: ',
					'●Emai: ',
					'●Tel: ',
					'●Address: ',
					'●Comments: ',
				];
			}

			let mailto = "mailto:yubune@azumi.co"
			mailto += '?subject=' + subject;
			mailto += '&body=' + body.join(encodeURIComponent(lineFeed));
			mailLink.attr('href', mailto);

		}

	}

	function noScroll(flg) {
		
		let movefun = function (event) {
			event.preventDefault();
		}
		if (flg) {
			ScrTop = $("body").scrollTop();
			$("body").addClass("noscroll").css({
				'top': -ScrTop
			});

			/*
			$(window).on('touchmove.noScroll', function(e) {
				e.preventDefault();
			});
			*/
			// スクロール停止の処理
			//window.addEventListener( 'touchmove' , movefun , { passive: false } );

		} else {

			$("body").removeClass("noscroll").css({
				'top': ScrTop
			});
			//$(window).off('.noScroll');
			// スクロール停止することを停止する処理
			//window.removeEventListener( 'touchmove' , movefun, { passive: false } );

		}
	}

	function goto(id, duration) {
	
		//let offsetY=$("header").height();
		let toY, offsetY;
		if (id == "#top") {
			toY = 0
			offsetY = 0;
		} else {
			toY = id;
			offsetY = 50;
		}
		if (duration == undefined) {
			duration = 0.8
		}
		

		TweenLite.to(window, duration, {
			scrollTo: {
				y: toY,
				autoKill: false,
				offsetY: offsetY
			},
			ease: Power3.easeOut,
			onComplete:function(){
			
				if (id == "#top") {
					history.replaceState("", document.title, window.location.pathname);
				}else{
					history.replaceState("", document.title, window.location.pathname  + id);
				}
			}
		});


	}

	function initSwiper() {
		if ($(".swiper-container").length) {
			new Swiper('.swiper-container', {
				speed: 1000,
				//effect: "fade",
				loop: true,
				lazy: true,
				loopFillGroupWithBlank: true,
				//preloadImages: false,
				navigation: {
					nextEl: 'div .swiper-button-next',
					prevEl: 'div .swiper-button-prev',
				},
				pagination: {
					el: 'div .swiper-pagination',
					clickable: true,
				},
				autoplay: {
					delay: 4000,
					disableOnInteraction: false,
				},
				on: {
					slideChange: function () {

						if (this.realIndex == 1) {

						} else {

						}
					},
					init: function () {
						// console.log('swiper initialized');
					},
				}
			});
		}

	}

	function log(str) {
		console.log(str);
	}

});


function unixTime2ymd(intTime) {
	let d = new Date(intTime * 1000);
	let year = d.getFullYear();
	let month = d.getMonth() + 1;
	let day = d.getDate();
	let hour = (d.getHours() < 10) ? '0' + d.getHours() : d.getHours();
	let min = (d.getMinutes() < 10) ? '0' + d.getMinutes() : d.getMinutes();
	let sec = (d.getSeconds() < 10) ? '0' + d.getSeconds() : d.getSeconds();
	return (year + '.' + month + '.' + day);
}

function getParam(name, url) {
	if (!url) url = window.location.href;
	name = name.replace(/[\[\]]/g, "\\$&");
	let regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
		results = regex.exec(url);
	if (!results) return null;
	if (!results[2]) return '';
	return decodeURIComponent(results[2].replace(/\+/g, " "));
}